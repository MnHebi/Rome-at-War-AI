
;-----Advance age-----
(defrule
	(current-age == dark-age)
	(or
		(up-compare-goal villager-count g:>= desired-ageup-villagers)
		(current-age-time >= 400)
	)
	(up-can-research gl-researchescrow-state c: feudal-age)
=>
	(up-research gl-researchescrow-state c: feudal-age)
	(set-goal age-up-started EARLY-ANTIQUITY)
	(chat-local-to-self "age up to early antiquity")
)

(defrule
	(research-completed feudal-age)
=>
	(set-goal age-up-finished EARLY-ANTIQUITY)
	(chat-local-to-self "finished aging up to early antiquity")
	
	(disable-self)
)

(defrule
	(current-age == feudal-age)
	(and
		(building-type-count-total market == 0)
		(building-type-count-total blacksmith == 0)
	)
=>
	(set-goal wait-techup-requirements YES)
)

(defrule
	(current-age == feudal-age)
	(and
		(building-type-count-total market > 0)
		(building-type-count-total blacksmith > 0)
	)
=>
	(set-goal wait-techup-requirements NO)
)

(defrule
	(current-age == feudal-age)
	(or
		(up-compare-goal villager-count g:>= desired-ageup-villagers)
		(current-age-time >= 300)
	)
	(up-can-research gl-researchescrow-state c: castle-age)
=>
	(up-research gl-researchescrow-state c: castle-age)
	(set-goal age-up-started MIDDLE-ANTIQUITY)
	(chat-local-to-self "age up to middle antiquity")
)

(defrule
	(research-completed castle-age)
=>
	(set-goal age-up-finished MIDDLE-ANTIQUITY)
	(chat-local-to-self "finished aging up to middle antiquity")
	
	(disable-self)
)

(defrule
	(current-age == castle-age)
	(and
		(building-type-count-total university == 0)
		(building-type-count-total monastery == 0)
	)
=>
	(set-goal wait-techup-requirements YES)
)

(defrule
	(current-age == castle-age)
	(and
		(building-type-count-total university > 0)
		(building-type-count-total monastery > 0)
	)
=>
	(set-goal wait-techup-requirements NO)
)

(defrule
	(current-age == castle-age)
	(or
		(up-compare-goal villager-count g:>= desired-ageup-villagers)
		(current-age-time >= 300)
	)
	(up-can-research gl-researchescrow-state c: imperial-age)
=>
	(up-research gl-researchescrow-state c: imperial-age)
	(set-goal age-up-started IMPERIAL)
	(chat-local-to-self "age up to imperial")
)

(defrule
	(research-completed imperial-age)
=>
	(set-goal age-up-finished IMPERIAL)
	(chat-local-to-self "finished aging up to imperial")
	
	(disable-self)
)

(defrule
	(current-age == imperial-age)
=>
	(set-goal wait-techup-requirements NO)
	
	(disable-self)
)